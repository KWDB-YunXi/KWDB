# LogicTest: 5node

statement ok
CREATE TABLE data (a INT, b INT, c FLOAT, d DECIMAL, PRIMARY KEY (a, b, c, d))

# Split into ten parts.
statement ok
ALTER TABLE data SPLIT AT SELECT i FROM generate_series(1, 9) AS g(i)

# Relocate the ten parts to the five nodes.
statement ok
ALTER TABLE data EXPERIMENTAL_RELOCATE
  SELECT ARRAY[i%5+1], i FROM generate_series(0, 9) AS g(i)

# Verify data placement.
query TTTI colnames,rowsort
SELECT start_key, end_key, replicas, lease_holder FROM [SHOW RANGES FROM TABLE data]
----
start_key  end_key  replicas  lease_holder
NULL       /1       {1}       1
/1         /2       {2}       2
/2         /3       {3}       3
/3         /4       {4}       4
/4         /5       {5}       5
/5         /6       {1}       1
/6         /7       {2}       2
/7         /8       {3}       3
/8         /9       {4}       4
/9         NULL     {5}       5

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a) FROM data]
----
eJyslNGKm0AUhu_7FMO5SmBER00261WWNoVAdrONKRQWL6aZgw0Yx86M0BLy7kUtrAm7o2V6qc4_3_9x5JxB_ywggXS1WX3ck1oV5PNu-0heVt-eNw_rJzL5tE736ZfNlPw9ouvThE-7U4IbngGFUgp84ifUkLwAAwohUIiAQgwUZpBRqJQ8oNZSNUfObWAtfkESUDiWVW2a1xmFg1QIyRnM0RQICez59wJ3yAUqPwAKAg0_Fi2mYS8rdTxx9RsopBUvdUI8nxFeCsKIND9QAYVtbRKyZJBdKMjavLK04TlCwi50fJ-HPFeYcyOVP7uuk359nCzZ9F1M-C7m9fa6lEqgQnF1dXaxF2HBvzWJrpqw8QNgYwbgM88PnUYw0KhnPncZQThePBwlHnp-5CQ-0KgnfuciHo0Xj0aJR54fO4kPNOqJL1zE4_Hi8Sjx2PNnTuIDjXri9_9r27yB2aGuZKnxZuu8fXPQbCMUOXarS8taHfBZyUOL6R63ba59IVCb7ivrHtZl96kp2A8zazi8CrPbcGgnD6Ajazq2h2OX3jNreG4nz13Id9bwwk5euJDv7bMKBn4T-092y84uH_4EAAD__x2N4J0=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum((a-1)*1000 + (b-1)*100 + (c::INT-1)*10 + (d-1)) FROM data]
----
eJzUVUFr4zwQvX-_QszJbmVs2U6b-pTQ5gNDknaTLCwUH9RoyAYSKyvZsEvIf19sb4kdWtmL9xKfrJl5evPeCOYI-scOIlhOppPHFcnVjvy_eJ6R18m3l-k4nhPrKV6ull-mNvlTovO9VXycOITZ5IYwz_Nsckss660WsqvQOori-So8J6q4KAN2xSV4xhOgkEqBc75HDdErMKDgA4UAKIRAYQAJhYOSa9RaqqLkWAJi8RMij8I2PeRZEU4orKVCiI6QbbMdQgQr_rbDBXKByvWAgsCMb3clTcE9OqjtnqtfQGF54KmOiOMywlNBGJHZd1RAYYGpQBWRQvmIOSwqdQ3tm0L9--HWskZ-M_f-X-aCyoxGRa1gVGWeJo_xbDy1ITlRkHl21qUzvkGI2Il21z7ebBRueCaVO2hKX36dWSP2OY3_Kc359jyVSqBC0bg6OZkbYd7fdRI0OmHdh826DNtljutfzbhb1Ndcvuszbr-7yX4nk33HDa7G5Bb1NZPv-5gcdDc56GRy4Ljh1Zjcor5m8rCPyWF3k8NOJoeOO7gak1vU10x--Ffb4QOaBeqDTDVebImPb_aK7YFig9Wq0TJXa3xRcl3SVMfnElcGBOqsyrLqEKdVqmiwDmZGsN8As0uwb2ZuoQ6M6NAMDvv0PTCC78zMd32Y743goZl52If5wTwrr-WZmB_ZJXdy-u93AAAA___5Ymft

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), count(a), max(a) FROM data]
----
eJy0lF2L2kAUhu_7K4ZzpTASJ4mumytla0HwY2sUFpZQps7BCjGTzkxgi_jfS5KlG2WdBGLvJh9vnpfnhHMC_TuGAMLpfPq0IZmKybf1akFepy_P88lsSTpfZ-Em_D7vkvdXdHbs8C4lO5klpjgd-VuHd8uc4IZHQCGRApf8iBqCV2BAwQUKHlDwgcIAIgqpkjvUWqr8lVMRmIk3CPoUDkmamfx2RGEnFUJwAnMwMUIAG_4zxjVygcrpAwWBhh_iApOzx6k6HLn6AxTClCc6ID2HEZ4Iwog0v1ABhVVmAjJmEJ0pyMx8sLThe4SAnWnzPpP9XuGeG6mcwWWdcLvojFkXKDyttsvN-3kxeSlOt-DuTfgHM0ukEqhQXACjs70e69_qF24XP2Z5Q_dfQ-92Q--iIWs-LtZkXA7rOW6rgdU0qhgZ3n9gbnMdbiMdbs_xWumoaVTR8XB_HV5zHV4jHV7P8VvpqGlU0TG6vw6_uQ6_kQ6_5wxa6ahpVNHx-H-32yfwNepUJhqvttznX-7n2w_FHstVqWWmdvis5K7AlJerIlfcEKhN-ZSVF7OkfJQXrIaZNexehNl12LWTa9CeNe3bw36b3gNreGgnD9uQH6zhkZ08akN-tM-qX_Ob2H-ya3Z0_vI3AAD__zEzA8I=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a+b), count(a+b), max(a+b) FROM data]
----
eJy0lF2L4jAUhu_3V4RzNTKRmrQ6Tq-UWRcEP2atwsBQlow5uII2bpLCLOJ_X9rKjMqYFuzeJW3fPi_PCdmD-bOBEKLBaPA0J6nekB-z6Zi8Dl6eR_3hhNx9H0bz6OeoQY6fmHR7J8g9eWtQslRpYj92W_F-XBf_kMKKGCgkSuJEbNFA-AoMKHCg4AOFACi0Iaaw02qJxiidfbLPA0P5DmGLwjrZpTZ7HFNYKo0Q7sGu7QYhhLl42-AMhUTttYCCRCvWmxyTsXs7vd4K_RcoRDuRmJA0PUZEIgkjyv5GDRRmmEjUIemx-x6H-EBBpfaTaKxYIYTsQKu36q9WGlfCKu21z0tFi_FdjzWAwtN0MZkf1-P-S766BudX4Z_MNFFaokZ5BowP7nqsda1ftBj_GmYN-UdD_3pD_6whqz40VmVoHmt6vIaxlfQ68dKpf2y8uhReSQpven4NUkp6nUh5qF-KX12KX0mK3_SCGqSU9DqR0q1fSlBdSlBJStD02jVIKel1IuXx_956X8BnaHYqMXhx-33951Z2K6JcYXGFGpXqJT5rtcwxxXaa5_IHEo0t3rJiM0yKV1nB0zBzhvlZmF2GuZtcgvad6cAdDm7p3XaGO25y5xbygzPcdZO7t5Af3bNqlRwT9yG7ZMeHb_8CAAD__3GhDwI=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum((a-1)*1000) + sum((b-1)*100) + sum((c::INT-1)*10) + sum(d-1) FROM data]
----
eJzMVdFqo0AUfd-vGO6TNiM6atrUJ0ubBSFNu0kWFooP08wlG0g0O6OwS8i_L2pJNDSjbMiSt5l7PJ57zly4W1C_VhDAdDgaPs5ILlfk6-TlmbwNf7yOHqIxMZ6i6Wz6bWSSj08MQ-Vrw-DEIswkN4Q5jmOSHimr77Wqua_OgyAaz_wDtodEVSslBc94DBSSVOCYr1FB8AYMKLhAwQMKPlDoQ0xhI9M5KpXK4pNtSYjEbwgcCstkk2dFOaYwTyVCsIVsma0QApjx9xVOkAuUtgMUBGZ8uSplCu1wI5drLv8AhemGJyogls0ITwRhJM1-ogQKE0wEyoAYIbNYUNoamDdFBB8XSozQbUI1xKuCaOB7OKzqT8PH6PlhBPGOQppnBzsq4wuEgO1od8sPi4XEBc9Safebjqffn42QmYXZ4uTuT97-5Jsnm3BPNnHQzpNUCpQoGsLxTt8mc_6lz8PLhH7PCL2eEbJe6JqnHXgNB6z75LAuk2Mzy3avfXZaTNce5fZys-N2T97tlLxr2d61J99iupb83eWS97on73VK3rNs_9qTbzFdS35wueT97sn7nZL3Lbt_7cm3mK4lf_9_NtUnTUxQbdJE4dHG-vzPTrHJUCywWnsqzeUcX2U6L2Wq60vJKwsCVVahrLpESQUVDdbJTEt2G2R2THb1yi3Snpbt68n-OX33teRbvfLtOcp3WvJArzw4R_le_1ZOy5joh-xYO959-RsAAP__vDGRBQ==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), min(b), max(c), count(d) FROM data]
----
eJy8lF2L2kAUhu_7K4ZzlcBInCTuurlSthYCfmyNwsISymzmYAXN2JkJbBH_e0lSWJXdSarYK_P1-j48Zzh70L82EEEyGo8eF6RQG_JtPpuQl9Hz03gYT4nzNU4WyfexS_5-ooutw11KtuvceS1_-ZuTuZRkssiNI9w6L7jhKVDIpcAp36KG6AUYUPCBQgAUQqDQg5TCTskMtZaq_GRfBWLxBlGXwjrfFaZ8nFLIpEKI9mDWZoMQwYK_bnCOXKDyukBBoOHrTVVTdg92ar3l6jdQSHY81xHpeIzwXBBGpPmJCtIDBVmY9wZt-AohYgfanmK4WilccSOV1zuFSJYTZ8BcoDCJp87Ar66Gz84gKK8eZ8vpwhmE7qcY_qcY7-1FLpVAheKkOj3YQVn3X0iT5eRH3MAanLCy9oNjbQbnsY7nXzC6Bo4jI3e3HJ3fXoffSoff8YILdDRwHOm4v6WOoL2OoJWOoOOFF-ho4DjS0b-ljrC9jrCVjrDj9S7Q0cBxpOPhf-25DzDmqHcy13i27z7-5265B1GssF6aWhYqwycls6qmvp1VueqBQG3qt6y-ifP6VQl4HGbWsH8SZudh397cUB1Y06E9HF7D3bOG7-zNd9c031vDfXtz_5rmB_usug3HxH7IzrvTw5c_AQAA___r-wZw

# AVG is more tricky: we do two aggregations (for the sum and for the count)
# and calculate the average at the end.
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT avg(a+b+c::INT+d) FROM data]
----
eJy0lF2L2kAUhu_7K4ZzleBInEncdXOVZWsh4MfWKBSWUGadQyq4GTuJpUX87yXJwkZZJwHNXb5en9fnDOcA2e8t-BCNJ-OnJdnrLfm2mE_Jy_jH8-QxnBHraxgto-8Tm7x_Iv4klmUJ0iOvNumRte-Hs6VXXEq7ykqRixgopEriTLxhBv4LMKDAgYILFDygMISYwk6rNWaZ0sUnhzIQyr_gDyhs0t0-Lx7HFNZKI_gHyDf5FsGHpXjd4gKFRO0MgILEXGy2JaZgBzu9eRP6H1CIdiLNfNJ3GBGpJIyo_BdqoLDAVKL2SeD1LCtgvYDbvcB9_y8QHymoff7RIMtFguCzI23f8jFJNCYiV9oZnpaMVlMrYDZQeJqvZsvy-hKSX0R-kPap0hI1yhNMfDSXYoNLraLV9GdY9OJ2XRVzAn6xp3vSk7UfIGszQIf1Hd7BCBt61mzd3WqEvL0a3koN7ztuB2oaetbU3N9KjdtejdtKjdt3vA7UNPSsqRndSo3XXo3XSo3Xd4YdqGnoWVPz0MVO_AS5wGyn0gzPduPnvzwodibKBKsFm6m9XuOzVusSU93Oy1z5QGKWV29ZdROm1auiYD3MjGF-EmbnYW4mN6BdY9ozh71reg-N4Tsz-e4a8r0xPDKTR9eQH8yzGjQcE_MhO2fHxy__AwAA__8K8hSc

# VARIANCE/STDDEV have three local (sqrdiff, sum, and count) and one final stage aggregations.
# We calculate and render the variance/stddev at the end.
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), round(stddev(b), 1) FROM data]
----
eJy8lF9r4kwUxu_fTzGcqwgjcSaxtblKqQoBq61JXxZKWKbOwRVsxp2ZLLuI331JUqhKTQLBvcv8efI88zuHswfzcwsBxJPZ5CEhud6S6XLxSF4n355m99GcOOMoTuLnWY98XDH5uyN6lGiVZ9IxVkr85bz1KGG9SiqFFSlQyJTEuXhHA8ErMKDAgYIHFHygMISUwk6rFRqjdHFlXwoi-RuCAYVNtsttsZ1SWCmNEOzBbuwWIYBEvG1xiUKidgdAQaIVm21pU3iHO715F_oPUIh3IjMB6buMiEwSRpT9gRooLHIbkJDRkEN6oKBy-2lnrFgjBOxA20e6X681roVV2h2eJopfHp2Q9Yowz8txNJ06IS9XxX759bB4mSfl96Uo_GKUzwR5prREjfLEPj3Uh2WDS2mn0fx-9j1OxuPJ_07IaejR0C8OlphJ1CW9jx4IOWVBEETzZHT5Dd7JG1j7CrM2FXZZ3-Vda9wQ6gjbzbVrzNvz4a348L7rdeXTEOqIz-21-Xjt-Xit-Hh91-_KpyHUEZ_Rtfn47fn4rfj4fXfYlU9DqCM-d_9yhn4RZYlmpzKDZ7P06z8PihmLco3VQDYq1yt80mpV2lTLRakrNyQaW52yahFl1VER8FjMasX8RMzOxbzeucHaq1X79WK_S-5hrfim3vmmi_NtrXhU7zzq4nxXX6tBQ5vUN9m5d3r4728AAAD__-nHIgQ=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), round(variance(b), 1) FROM data]
----
eJy8lF9r4kAUxd_3Uwz3KcJInEm0Nk8RqxCwsY12WShhmToXV9CMO0mWXcTvviQpVKVOAsG-Zf6cnDO_e7kHSH9vwYPFZDYZL0mut2QazR_J6-TH02wUhMR6CBbLxfOsQ96vpPnOEh1KtMoTaf0ReiOSFVpvHUpYpxJLkYkYKCRKYih2mIL3CgwocKDgAAUXKPQhprDXaoVpqnRx5VAKAvkXvB6FTbLPs2I7prBSGsE7QLbJtggeLMXbFiMUErXdAwoSM7HZljaFt7_Xm53Q_4DCYi-S1CNdmxGRSMKIyn6hBgrzPPOIz6jPIT5SUHn2YZdmYo3gsSNtHmm0Xmtci0xpu3-eaPHyaPmsU4R5jh6C6dTyebkq9suv8fwlXJbf16Lwq1E-EuSJ0hI1yjP7-GgOy3rX0k6DcDT7-X0UBaNwPLF8Tn2H-m5xFGEiUZf83vvA55R5nheEy-H1Vzhnr2DNa8ya1NhmXZu3rXJNqBNwg1tXmTfnwxvx4V3bacunJtQJn7tb83Ga83Ea8XG6ttuWT02oEz7DW_Nxm_NxG_Fxu3a_LZ-aUCd87r9yin4SJcJ0r5IUL6bp53_uFVMW5RqrkZyqXK_wSatVaVMt56Wu3JCYZtUpqxZBUh0VAU_FzCjmZ2J2KeZm5xprx6h2zWK3Te6-UTwwOw_aON8ZxUOz87CN8725Vr2aNjE32aV3fPz2PwAA__9--SNC

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT stddev(a+b+c::INT+d) FROM data]
----
eJy0lF1r4kAUhu_3VwznKuJInCT2I1cpVSFgtTXpslDCMnUOrmAz7sy47CL-9yWJUJU6CUjuJh-v7-NzwtmB_r2GEJLRZPSYkq1ak_F89kTeRj-eJw_xlDjDOEmTl0mHHF7RRgj84zgOJ13y3iFdsgjDeJoGxVF0qrjghmdAIZcCp_wDNYRvwICCBxR8oBAAhQFkFDZKLlBrqYpXdmUgFn8h7FNY5ZutKW5nFBZSIYQ7MCuzRggh5e9rnCMXqNw-UBBo-Gpd1hTd0UatPrj6BxSSDc91SHouIzwXhBFpfqECCnPMBaqQREHXcSLWjbxON_IP_wWyPQW5NZ8E2vAlQsj2tDnlw3KpcMmNVO7gFDJ5mQ_j8diJWKdgfH06nB5nr9O0PF8C8C4CfPZuc6kEKhQnpdnejsjORI7j6cPkZ5IOh6PvTsRo5NHIvwzmn4Cx5vNjTebnsp7rtTDBGs4jPTftTNBrLsprJMrruX4Lomo4j0TdtiPKby7KbyTK77lBC6JqOI9E3bUjKmguKmgkKui5gxZE1XAeibpvf3l-ATBHvZG5xrMl-vUv94vlimKJ1SbWcqsW-KzkoqypLmdlrrwhUJvqKasu4rx6VAAeh5k17J2E2XnYszfXVPvWdGAPB9dwD6zhG3vzzTXNt9bwnb357prme_us-jWfif0jO-_O9t_-BwAA__-WcCJa

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT variance(a+b+c::INT+d) FROM data]
----
eJy0lF1r4kAUhu_3VwznKuJInCS2NlcRqxCwsY12WShhmWYOrmAz7mRcdhH_-5JEqEqdBCR3k48375PnDLOH_PcGfFhMZpPxkuzUhkzj-RN5m_x4no3CiFiP4WK5eJl1yPGVP1yteZaiZVmcdMl7h3RJ6vthtPSKpehUHxBc8wQoZFJgxD8wB_8NGFBwgIILFDygMICEwlbJFPNcquKVfRkIxV_w-xTW2Xani9sJhVQqBH8Peq03CD4s-fsGY-QCld0HCgI1X2_KmqI72Kr1B1f_gMJiy7PcJz2bEZ4JwojUv1ABhRgzgcongde1rIB1A6fTDdzjv0ByoCB3-pMg13yF4LMDbU45Wq0UrriWyh6cQy5e4sdwOrUC1ikYX5-Oq_H8NVqW62sAzlWAz95dJpVAheKsNDmYEdmFyGkYjWY_v4_icBSNJ1bAaODQwL2O5p6hseYTZE0maLOe7bQwwxrOE0F37czQaS7KaSTK6dluC6JqOE9E3bcjym0uym0kyu3ZXguiajhPRA3bEeU1F-U1EuX17EELomo4T0Q9tH98fgEQY76VWY4Xx-jXX-4XxyuKFVZncS53KsVnJdOyprqcl7nyhsBcV09ZdRFm1aMC8DTMjGHnLMwuw465uabaNaY9c9i7hXtgDN-Zm-9uab43hofm5uEtzQ_mWfVrtol5k112J4dv_wMAAP__Mf8jmA==

# Test various combinations of aggregation functions and verify that the
# aggregation processors are set up correctly.
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), avg(b), sum(c), avg(d), stddev(a), variance(b), sum(a+b+c::INT+d) FROM data]
----
eJzUVt9r4kAQfr-_YpmnBEfibuKvPK1UhYC1rbHloEjZZhdPsIm3ieWO4v9-JPE0ljYJCIJvM5n59vtmv4HNB8S_1-CCP5qMbuZkq9dkPLu7Jc-jn_eTgTclxtDz5_7DxCT7lnj7ZggTiXhfGq8mZnmwz2WaJ1Kq96zlXeiVCAN16DMMQRrk1SQNEriuN507aSjNnFOKRCwAIYykmoo3FYP7DBQQGCDYgOAAQhsWCBsdBSqOI522fGQAT_4Bt4WwCjfbJP28QAgircD9gGSVrBW4MBevazVTQipttQBBqkSs1hlNys03evUm9F9A8DcijF3StCgRoSSURMkvpQFhpkKptEu40zAMThucmQ1u72dBwikSzpBwGwl3YLFDiLbJUVGciKUCl-6wvurBcqnVUiSRttqnov3HW4MzM9WbRnYa3dw9Tuf7OPvqHKJ2oZ7F_sNs6I3H-zP2FXZSOZ5DzW_HYd-Oc5xiG0ZaKq3kyQiLXfnAtPXFxPSg6f_sL17pzIeOTpqNvelg8uLPh8PRk8G7yCny3rHwNJh5g-nNyOB95AyLN9AyixuQWW3lTiPhbYt3kPAuEt5Dwvvf3pZ9clu0_srSOitr0abFLrC0FboLHnauYWlZfRtYLRtY07IvYEOF7oIN3Wuwwa5vg13LBrtpORewoUJ3wYbeNdjg1LfBqWWD07TaF7ChQnfBhv412FDxYzBT8SYKY_XpRf365Fb60iq5VPmzHEdbHah7HQUZTZ7eZbjsg1RxkldpnnhhXkoFFsG0FMxOwPQzmJUzV1DbpWinHOyco7tdCu6UM3fOYe6WgnvlzL1zmPvlXrUq1qR8yT5zL3Y__gUAAP__fJK54g==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), min(b), max(c), count(d), avg(a+b+c::INT+d), stddev(a+b), variance(c::INT+d) FROM data]
----
eJzUVl9r-koQfb-fYpmnDY7ETeKf5mmlKgSs_VVtKRQp2-ziFTTxbmLppfjdf2y0NiltEuiD-NTJzJyeOXMG3HdI_luDD7PheHg9Jzu9JqPp7Q15Gj7-GfeDCaGDYDaf3Y0tcmxJdhsqLCSbVURfzF_xRkMLSRjvopRKC4l4XVJKBWmQF4s0SOj7wWTumdBUk1RK9XosI3kVeiWiUNFjW9Z1mEGKVCwAIYqlmoiNSsB_AgYIDiC4gOABQhsWCFsdhypJYm1a3jNAIN_AbyGsou0uNekFQhhrBf47pKt0rcCHuXhZq6kSUmm7BQhSpWK1zmgMN9_q1Ubo_wFhthVR4pOmzYiIJGEkTv9VGhCmKpJK-4R7DUo5a3DHanD3qBhJlkFT_UiaHJIs6ZoCLPYI8S79nDJJxVKBz_ZYX0l_udRqKdJY2-2ikNn9DeWeBQg3wYTydhb1HynvmOj69n4yp7xr4qyT5bJZPLubDoLRiHLn1OPkepxCj3vqcXM9rvWjSOdHkZ_adlGspdJKFoQt9uVrYK1v9sBOe3BOe_iY-Tkws3onBe1CPtvWKJj0x8-z-WAwfKC8i7yH_Oqz8NCfBv3J9ZBy1kLOGHKW0ZxupGA8Et62eQcJ7yLhvR9X5BZWxOpfNKtz0TZr2s6ZbrpCS87MzuXetFPfMKeWYU7Tds9kWIWWnGHdyzXMrW-YW8swt2l7ZzKsQkvOsN7lGubVN8yrZZjXtNtnMqxCS86wq8s1rOItM1XJNo4S9eXn_vv_3DLPACWX6vBmSOKdDtUfHYcZzeHzNsNlCamS9FBlh48gOpTMgHkwKwU7BTD7CnbKmSuo3VK0Vw72fjN3uxTcKWfu_Ia5WwrulTP3fsN8Ve5Vq-JMyo_sK_di_8_fAAAA__8HAOiy

# Verify that local and final aggregation is correctly shared and de-duplicated.
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), stddev(a), avg(a) FILTER (WHERE a > 5), count(b), avg(b), variance(b) FILTER (WHERE b < 8), sum(b) FILTER (WHERE b < 8), stddev(b) FILTER (WHERE b > 2) FROM data]
----
eJzsVk1vqzgU3c-vsO6KSI7AfOSDlaOGaJDStCVpZ6ROVDlgZSIlkGegek9V_vsT0AbI40vqIpuswNf33ON7fK7kDwh_7MGEpTW37lYoFns0cx7u0av17-N8Yi-QNLWXq-XTvIc-U8L4ILEeRmHkefw9_WXvW4n10MyerywHSf_8bTkWYui_WFE0joweRm4Q-5G0-cxNvu9M7JjvcmlzCdxkQBeNEpb40JaRnaMuiSO1l7XksYitAYMfeHzBDjwE8xUIYFABgwYYdMBgwBrDUQQuD8NAJCkfKcD2foKpYNj5xzhKwmsMbiA4mB8Q7aI9BxNWbLPnDmceF7ICGDwesd0-pUm46VHsDkz8AgzLI_NDE_VlgpjvIYKC6H8uAIPDfY8LE1GSHd4wTdNerEYYUTXreXQZ4WoeIUkU1icMQRzlBw0jtuVgkhPu3sxkuxV8y6JAyEa5l-XzvUT1XtLGkzO1Z7PP1d3D82L1tZPlfF0JJcX9qqhxRhmlykaereYZpdi5QjmzooJWUUGrrKDViqjWiphrF_uB8LjgXkm49alZZqJU6EwSNWb2YjJ_W66mU-tFoiqmBFOtIHP292YXhcxWg3PWMC_0MnHsyeLOkugI0zGmRDlnjf-kIwRTknCmjLlBE6thRDWZ6hhRAyM6kNPPECOamHFcq6FW0pB0nyrSZapk0pfV681VSzuFCx_c5qpurtTunlA7eULty9r1PNHSTsETw5sn6jyhdfeE1skTWl_Wr-eJlnYKnhjdPFHnCb27J_ROntD7snE9T7S0U_DE-OaJLm-yChEdHh4DP-QXb7PqykryZuPelmcPvDCIhcsfReCmNNnyIcWlAY-HUbZLsoXtZ1vJAYtg0ghWS2ByCVabmVuotUa03gzWv3NuoxE8aGYefId52AgeNTOPvsM8br4rpcUmzSa75F6f_vodAAD__7ANjMI=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), avg(DISTINCT a), variance(a) FILTER (WHERE a > 0) FROM data]
----
eJy0k8GOmzwQgO__U1hzSiRHYCC_Kp8SpWyLlGW3QLeVthxcPKJIBFPbrFpFefcKaJVmla6okh49M5_n81izB_O1Bg5puA03Gel0TW6Su1vyGH68366jmMxeR2mWvtvOyc8S0-1mYk6JeCqHXBRvMtIHnoSuRFPgTMzJTbTNwoTMPrwNk5AI8qlzXR-JOx9vl8KKHCg0SmIsdmiAPwIDCh5Q8IFCABSWkFNotSrQGKX7kv0ARPIbcJdC1bSd7cM5hUJpBL4HW9kagUMmPteYoJCoHRcoSLSiqoc2fe9Vq6ud0N-BQtqKxnCycBgRjSSMKPsFNVBIsJGoOVmxUd7lnEdx9oqSFYP8QEF19ihgrCgRODvQP0ge3bpGaYka5YlXfjjzjHVZaiyFVdpZnr4ifX87W3lzoLB-eHP8hzH0sE6idbwJ-4pfX_GCtHcizaZPlk2ZrMMWjnf92XrTNb1Jmt7C8a-v6U_X9Cdp-gsnuL5mMF0zmKQZLJzlv12oM5oJmlY1Bp8t1vmb3X7hUJY4bqdRnS7wXqtiaDMe7wZuCEg0dsyy8RA1Q2oQ_B1mL8L_n8Duc9i7pLN_CRxcAi__Cs4P__0IAAD__9RoCg8=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), avg(a), count(a), stddev(a), variance(a) FROM data]
----
eJy0lF9ro0AUxd_3Uwz3KYEJZtT0j0-GJgEhTVpNy0KRMutc3EDqZGfGskvJd1_UQk1oVJA8hMz1ejzH35X7AfrPDjyI5sv53YbkakcW4fqevMx_PiynwYoMZkG0iR6XQ_J5i87fBnxICX9Py_9E5pkpT9oIge_l8Z2rLc8SHPBh9TzBDY-BQiYFrvgbavBegAEFGyg4QMEFChOIKeyVTFBrqYpbPkpBIP6CN6awzfa5KS7HFBKpELwPMFuzQ_Bgw3_tMEQuUFljoCDQ8O2utCm8_b3avnH1DyhEe55pj4wsRngmCCPS_EYFFNa58YjPID5QkLn58tKGpwgeO9DueaZpqjDlRiprchwnerof-GwIFO7WT6vN5zl6DGfBYlFW5wLYZwN8-eaZVAIViiPT-NAckY3PZYye7l-DIqVdVItgNV2-RpvZbP488B3qM1pvPE_DYLq6mx-1QswEqoIsJT6zfJuS8udQ4rtn39U5elfWffisy_AtNrLsXuNvSVRje3WZ8dvdkdidkNgjy-mFpCVRDcn1ZZA43ZE4nZA4I8vthaQlUQ3JzWWQuN2RuJ2QuCNr0gtJS6IaktvL781vAoSo9zLTeLI_v3_yuNirKFKslrCWuUrwQcmktKnKdakrLwjUpuqyqgiyqlUErItZo9g-ErNTsd3s3GLtNKrdZrHbJ_ekUXzV7HzVx_m6UXzT7HzTx_m2eVbjls-k-SM79Y4PP_4HAAD__wrIIvU=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), avg(b), sum(a), sum(a), avg(b) FROM data]
----
eJy0lF-L2kAUxd_7KYb7pDASZxJ33Txl2VoQ_LM1CoUllFnnkgqasTOT0iJ-95Kk7aqsk0Ds272TnJyT3x3uAcz3LYQQjyajpyXJ9ZZ8Wsyn5GX05XnyOJ6RzsdxvIw_T7rkzysm33VElxLxI-28dum__vy8-ooUViRAIVMSZ2KHBsIXYECBAwUfKARAYQAJhb1WazRG6eKVQykYy58Q9ilssn1ui-OEwlpphPAAdmO3CCEsxesWFygkaq8PFCRasdmWNoV3tNebndC_gEK8F5kJSc9jRGSSMKLsN9RAYZ7bkESMRhySIwWV2zc7Y0WKELIjbR7pMU01psIq7Q3OE8WraSdi3SJMUfGiepqvZsuyvmbOr5q_eeaZ0hI1yjPD5OiOx_r1-eLV9Ou4SOgX3QIzibrERSLuRT6tyr_t1Z_wz36CNR8qazJUj_U83nasNaFOuN3dfqy8ORHeiAjveX5bIjWhTojc356I35yI34iI3_OCtkRqQp0QGd6eSNCcSNCISNDzBm2J1IQ6IfLwf5fhO-YLNHuVGbxYiu9_uV8sS5QpVpvVqFyv8VmrdWlTtfNSVx5INLZ6yqpmnFWPioCnYuYU8zMxuxRzt3ONte9UB25x0Cb3wCm-czvftXG-d4qHbudhG-cH96z6NdfEfckuvZPjh98BAAD__4gfEsY=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT avg(c), sum(c), avg(d), sum(d) FROM data]
----
eJy8lF-L2kAUxd_7KYb7ZGAkThJdN08R64Lgn61RKCyhTJ1LKmhiZyalRfzuJYmwUdZJILhP8d7M8Zz87nBPoH7vwYdwMpuM1ySTe_KyWs7J2-T762w0XZDO12m4Dr_NLHI5wv_Ena1FicoOxTOvxaUWVqkWXPMIKCSpwAU_oAL_DRhQcICCCxQ8oNCHiMJRpltUKpX5kVMhmIq_4Pco7JJjpvN2RGGbSgT_BHqn9wg-rPnPPa6QC5R2DygI1Hy3L2xy7-Aodwcu_wGF8MgT5ZOuzQhPBGEk1b9QAoVlpn0SuDTwIDpTSDP9bqc0jxF8dqbNI43iWGLMdSrt_nWicDPvBMwCCuPlZrG-_C66TqXrWHeDOHeDvPtnSSoFShRX5tHZHJX17mUNN_Mf00uuS1r3qu_l1QoTgdInAbPHozA_PQpfZsvRemhREjBKAtcOvPxx9-Pcq49jzQfPmgzeZl3baTv6mlAVnoPHjt5pTsdpRMfp2m5bOjWhKnSeHkvHbU7HbUTH7dpeWzo1oSp0ho-l4zWn4zWi43Xtfls6NaEqdJ4_b6l-EGSF6pgmCm-W68f_3MuXLooYyw2t0kxu8VWm28KmLJeFrmgIVLp8y8pimpSv8oBVMTOKnSsxuxU7Zucaa9eo9sxir03uvlE8MDsP2jg_GcVDs_OwjfOzeVa9mmtivmS33tH5y_8AAAD__4dvJK0=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT max(a), min(b) FROM data HAVING min(b) > 2]
----
eJyslF2L2kAUhu_7K4ZzpTCSzCS67lxFWrcN-LFVKQvbXMyagw3EjJ1MYIv434um3Y2yTgLxMpN587w8J5w95L9TELAcT8afV6TQKXlYzKfkefz0OBmFM9L5Ei5Xy--TLvl3ZStfO7JLyTbJOi_d8nYsjSTfRj_C2df_5z8L1_WQ8AgoZCrGmdxiDuIZGFDgQMEDCj5Q6ENEYafVGvNc6eOV_SkQxq8gXApJtivM8TiisFYaQezBJCZFELCSLykuUMaoHRcoxGhkkp4wx0rBTidbqf8AheVOZrkgPYcRmcWEEWV-oQYK88IIEjAacIgOFFRh3nG5kRsEwQ60eaXRZqNxI43STv-80XT01AlYFyhMw1kn4N2rQH4V-M4pMqVj1BifQaKDvRJz6zpReEhSg1qQgL8NUQgRzlbDq4W9s8Ks-dBYk6E5rOfwtmOrKVVxNLjN2HhzC7yRBd5zvLYWakpVLNzdxoLX3ILXyILXc_y2FmpKVSwMb2PBb27Bb2TB7zn9thZqSlUs3N9-kX0AXGC-U1mOFwvt4y-7x0WH8QbLrZirQq_xUav1CVM-zk-500GMuSnfsvIhzMpXx4LVMLOG-VmYXYa5nVyD9qxp3x722_TuW8MDO3nQhnxnDQ_t5GEb8r19Vm7Nb2L_yS7Z0eHT3wAAAP__Aw8AAw==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT DISTINCT (a) FROM data]
----
eJyslEFvmzAYhu_7FdZ3ajUjMJA05ZSpzSSkLOmSHCZVHDz8qUOimNlG2hTlv0_AlC7RYqySo8Evz_vwWd6D_llCAtvFcvGwI40qyefN-gt5Xnx7Wn5KV-TmMd3utl-Xt-Tvlnadrh525Ibf9nsFNzwDCpUUuOKvqCF5BgYUQqAQAYUYKEwgo1ArmaPWUrVb9l0gFb8gCSgUVd2Y9nFGIZcKIdmDKUyJkMCOfy9xg1yg8gOgINDwouwwLXteq-KVq99AYVvzSifE8xnhlSCMSPMDFVBYNyYhcwbZgYJszBtLG_6CkLADde_zWGhTVLnxJ6dl5q30WglUKKy08CLtDSL775wTPkJ2sFViwTs7RSedmPtEmMtEfOb54aiZDDQ6_oDpVWYSuvuHTv6h50ej_AcaHf3vruIfuftHTv6R58ej_AcaHf1nV_GP3f1jJ__Y8yej_AcaHf3vr34n_Ye2QV3LSuMJ69KXg_bCQvGC_QWnZaNyfFIy7zD9ct3lugcCtenfsn6RVv2rtuC_YWYNhydhdh4O7eQBdGRNx_ZwPKb3xBqe2snTMeQ7a3hmJ8_GkO_tswoGjon9kJ2zs8OHPwEAAP__EaTtnQ==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT SUM (DISTINCT A) FROM data]
----
eJyslFGLm04Uxd__n2K4T__ABDNqslmfsuymIGSTbUyhsPgwdS5WMI6dGaEl5LsXtSRNyI4S--g4557z88g9gP6RQwDRcrV83pFK5eTTdvNK3pdf31ZP4Zr8_xJGu-jzakT-XNHVvjkL1887wkftdcENj4FCIQWu-R41BO_AgIILFDyg4AOFKcQUSiUT1Fqq-sqhEYTiJwQTCllRVqY-jikkUiEEBzCZyREC2PFvOW6RC1TOBCgINDzLG5vae1GqbM_VL6AQlbzQARk7jPBCEEak-Y4KKGwqE5AFg_hIQVbm7KUNTxECdqT987xk2mRFYpzpZRjLfPfD-eexVSGVQIXiYmp8vJHgKU0VptxI5bCrLxJ9eT1XtGCjDyN5F5FY_wpYnwocNnbcQSV0JDqVMLuzBLc_sduL2B073iDijkQn4oc7ib3-xF4vYm_s-IOIOxKdiOd3Evv9if1exP7YmQ4i7kh0In78B6vlxvwt6lIWGq9WzO3Jk3r1oEix3VNaVirBNyWTxqZ93DS65kCgNu1b1j6ERfuqDvi3mFnF7oWYXYtdu3OHtWdV-3axPyT31Cqe2Z1nQ5wfrOK53Xk-xPnR3tWk4zex_2TX3vHxv98BAAD___81234=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT SUM (DISTINCT A), SUM (DISTINCT B) FROM data]
----
eJyslFFr2zAUhd_3K8R9WkDBkey0qZ9S2gwCadIlGQyKH9To4hkcy5Nk2Aj578P2SOaQyibeo650dM6nK-4BzM8UQtjMFrOnLSl0Sr6sVy_kbfb9dfE4X5LPz_PNdvN1MSB_j5hiX9Xmy6ctEQPaLLwPar0UVkRAIVMSl2KPBsI3YECBAwUfKARAYQwRhVyrHRqjdHnkUAnm8heEIwpJlhe2LEcUdkojhAewiU0RQtiK9xTXKCRqbwQUJFqRpJVN6T3NdbIX-jdQ2OQiMyEZeoyITBJGlP2BGiisChuSKaNTDtGRgirs2c5YESOE7Ei7R3pOjE2ynfXGzTxuC_6hxfnmIlNaokbZuDg6XgnxGMcaY2GV9tjFu2y-vZwbNWWD8m0aJT74MKXfSMm694Z16Y3Hhh7v252WUKfu3N3eHd6dm3fi5kPP78vdEurEfX87t9-d2-_E7Q-9oC93S6gT9-R27qA7d9CJOxh6477cLaFO3A__ZwpdsVijyVVm8GIaXb95VE4plDHWI82oQu_wVatdZVMvV5WuKkg0tt5l9WKe1VtlwH_FzCnmDTG7FHO3c4u171QHbnHQJ_fYKb5zO9_1cb53iidu50kf5wd3r0Yt38T9yS69o-OnPwEAAP__IcvrKg==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT DISTINCT a, b FROM data WHERE (a + b + c::INT) = 27 ORDER BY a,b]
----
eJy8lFFr2zAUhd_3Ky73KSUKjmSnTQUDb43LDFnSOYFtFD8otugMrp1JCmyE_Pdhe6RNWGVDsjxeSUffuecKbVH_zJHjIpgGd0vYqBzuo_lneAy-PUw_hDPoTcLFcvFlegV_j1R1OLtbgiCwag6nwgj4-imIAuj1BPRhdQV9SDgPZ0vvCt4Du4F5NAki-Pi9lsVIsChTORPPUiN_RIoEGRJ0kaCHBEcYE1yrMpFal6o6sq0FYfoL-ZBgVqw3plqOCSalksi3aDKTS-S4FKtcRlKkUjlDJJhKI7K8xlRG_bXKnoX6jQQXa1FoDgOHgihSoFCaH1IhwfssN1Jx6PV8Cn3wWdWP775uiNfFGAnON4aDT4nPMN4RLDfmxZs24kkipzvS3f8k0yYrEuOMDs03CIJzlUol0zYme5P5giqbq445feKzPsY7mzk6PMmde-COdp8o7TJRhw4cdtGZtnSwj-36jDNl3VNjnVJjA8e9aGotHexTuzljam731NxOqbkDx7toai0d7FMbnzE1r3tqXqfUvIEzumhqLR3sU7v9T7_uP5iR1Ouy0PKA-NbNw-o7lumTbL5wXW5UIh9UmdSYppzXunohldo0u7QpwqLZqgy-FlOrmB2I6bGY2cktaNeq9uxi7xTfI6v42k6-PoV8YxWP7eTxKeRb-6yGLc_E_siO2fHu3Z8AAAD__-rsNxA=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT DISTINCT a, b FROM data WHERE (a + b + c::INT) = 27 ORDER BY b,a]
----
eJy8lVFr2zAUhd_3Ky73KcUKjmSnaQUDb43LDFnSOYFtFD8otugMrp3JCmyE_Pdhe6RNWGSXZHm8ko6-c48v8gbLnxlynPsT_24Ba5XBfTj7DI_-t4fJh2AKvXEwX8y_TK7g75GqDqZ3CxAEls3hRGgBXz_5oQ-9ngALlldgQcx5MF24V_Ae2Ahm4dgP4eN3WBIQERLMi0ROxbMskT8iRYIMCTpI0EWCQ4wIrlQRy7IsVHVkUwuC5BfyAcE0X611tRwRjAslkW9QpzqTyHEhlpkMpUiksgdIMJFapFmNqYx6K5U-C_UbCc5XIi859G0KIk-AQqF_SIUE79NMS8Wh1_MoWOCxqh_Ped0Qr4sbJDhbaw4eJR7DaEuwWOsXb6UWTxI53ZLu_sdpqdM81vZw33yDIDhTiVQyaWOyo8wXVNFcdcixiMcsjLYmc3RwkjvnLYnMC6Wlsik9QDKLeNQ6ynD3GLT71NAuU2PTvs0uOjctHew-zfUZ54Z1T411So31beeiqbV0sEttdMbUnO6pOZ1Sc_q2e9HUWjrYpXZzxtTc7qm5nVJz-_bwoqm1dLBL7fY_vez_YIayXBV5KfeIx24eVE--TJ5k85soi7WK5YMq4hrTlLNaVy8kstTNLm2KIG-2KoOvxdQoZntieihmRrFjJjtm28ysdo3qoVk8PKXpa6N4ZCaPTiHfGMW3ZvLtKWTaMmNtQ_a2KYu27_4EAAD__1Laaz8=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT c, d, sum(a+c::INT) + avg(b+d) FROM data GROUP BY c, d]
----
eJzUll1vukgUxu_3U0zOlcYxODPgC1d0u92NicWuL8k2jWmoTKyJBXfAzTaN3_0fwNYX2jkYMdErEfjNOXOeZ57wAdG_C7BheNe7ux2RlVqQPwf9e_J0989D76brksof3eFo-HevSjavTCnxKYlWbxWP1MjUtrvuyKySGvH-m1VeSI341WwJ34s98tegP34gvz-m2AQoBKEvXe9NRmA_AQMKHCgIoGACBQsmFJYqnMooClXyykcKdP3_wW5QmAfLVZzcnlCYhkqC_QHxPF5IsGHkvSzkQHq-VEYDKPgy9uaLtEzSibNU8zdPvQOF4dILIpvUDUa8wCeMhPGrVEBhIANfKps4rOaIbGOUOLzmJD-CEseEyZpCuIq3bUSxN5NgszUt3urNbKbkzItDZVj7nTqCOskgbtzHZ7c_enbHvV7FEdXcLTO5NRzfVxz2dcWTq9v-2B2l1_utbqu_vJNXL3o9KMyow2Gy3u6I_7ij7VKrIFS-VNLfWyxdRbNn1viu9uEOWX7T_Gur4uvqcxDP3WTbVnVPxkS9T-kMx_pRPXGMem5YD5cGO1AuX7SmsYtZ7nCzlnjj4M3va1t7tVnxU8WKnCqD1Q1-rnOFNLvjseaVnCtW5rlil32uEPU256pZ3rnixb3NC3mb1w1xLm8jze7o3LoSb_Myvc0v29uIehtvt8rztijubVHI26JumOfyNtLsjs7tK_G2KNPb4rK9jai38Xa7PG-bxb1tFvK2WTesc3kbaXZH586VeNss09vmZXsbUW_j7c55vvW_KTiQ0TIMIlnoS76RDF_6M5kpFYUrNZUPKpymZbK__ZRLb_gyirOnLPvTDbJHSYO7MDuE2S7M92B2HNw6BWbsJNo6ie7oaa4duNAPXGhhU1_Z1MIc0drS0k093DzFKHoYMYoexoyC0IhREBoxSks78LZ-4O1TjNLRZ0IDCYVcpByVCnoaiwU9jeYCgmPBgOCI4CwXLPtz58jc9cmCaM700cJMpHguXI4SXU9joutpVHQEx0RHcEx0fa4yJFhZLmOOEl2fMQwJGZZLmaNE19OY6HoaFR3BMdERHBNdn7AcSViu_2g7FH2y_u1XAAAA___G6w5S

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT c, d, sum(a+c::INT) + avg(b+d) FROM data GROUP BY c, d ORDER BY c, d]
----
eJzUl1tv4kgQhd_3V7TqCeRGpi_OxU_OzmRXSIzJApF2NEKRg1skEsFs26x2FOW_r3xJgs2ky6hjKXmK6XB8ylX1HZlHSP9Zgw-zy_HllznZ6TX5Yzr5Rn5c_n01vhiFpPd1NJvP_hr3SfWVJSUxJenuoRcRhyx9fxTOZZ84JPp31bslDon75S3iKIvIn9PJ9RX5_XshI5Pp18vp86cFUNgksQqjB5WC_wMYUOBAQQAFCRQ8WFDY6mSp0jTR-VceC8Eo_g_8IYX7zXaX5ccLCstEK_AfIbvP1gp8mEe3azVVUay0OwQKscqi-3Vhk9cVbPX9Q6R_AoXZNtqkPhm4jESbmDCSZHdKA4Wp2sRK-yRgTiDKx6Qk4E6Q_xGUBBIWTxSSXfZaRppFKwU-e6LtS50lOlPa9epVBsKhgXTetODHWFysVlqtoizRLhs2fWiQN3uiY6VV7JPng4vw-004md-E1-NxLxD9gyOZH82uv_UC9nLF86svk-twXlzXi3-t5_YnuYvSu0YljAYcFk-vzyjefMbXWyVl3c1bOTTgTnkzUzOaTS9K2G9GdVB_cnbYDP7SAvFy9dygm1HeDq9f26l8lZ73yA28N-csj5lzmAySrcsbIz40dQy763XS9Kqyer_fKuGkVgJrTzprQ7rLBi7vinWk2Ir1ExvWEYv99WaflXXWAevNpn901pE5V0Sx92OdtweNtwKND1zRFWhIsRVopzagIRb7u8U_K2i8A9CaTf_ooCFzrkDj7weaaA-aaAWaGLiyK9CQYivQzmxAQyz2d0t8VtBEB6A1m_7RQUPmXIEm3g802R402Qo0OXC9rkBDiq1AO7cBDbHY3y35WUGTHYDWbPpHBw2ZcwWa7OZn4i8MpyrdJptUtfr1N8ynoeKVKieYJju9VFc6WRY25cdJoSsOYpVm5X9Z-WG0Kf-VF7gvZkYxN4t5U8z2xaImZseJz23ETFqprbw54i2MDZfmhkuj2DM7e-ZRn5itT4zqU7P41Cg-M4vPbLbMLEYmbRZjW4aorbyxLTs3Z8IQCQVzpCB7xsyZwpBQYQd81eUCkR8Adsy6IGpkZogaWxhMbueOrQwzhwvzkL6b4wXbGXO8MCRfmDlgGJIwzCpiEDU2NbuQweR27ujOmHOGIznDrXKGI-8u2MuLOWc4kjPcKmcQNfYGYpczmNzOHdsZbs4ZjuQMPy5nFk-__R8AAP__mZNK7g==

# There should be no "by hash" routers if there is a single stream.
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT c, d, sum(a+c::INT) + avg(b+d) FROM data WHERE a > 9 GROUP BY c, d]
----
eJyUkk-PlEAQxe9-ikqdmNCb4c94sE-9Kq4kLDMCo25WsumlK2QShsZuMJrJfHcDmLijEfVE6lW9x68oTmg_N8gxj5LoVQGDaeBNtr2F--jjLrmOU3Bex3mRv0tW8GOkYqAY2OHoSHCh4jxOi80KXJBfaucRXFCrOULJXsKHt1EWgYRPg-eFBC_gJtvud_DybsopkWGrFaXySBb5PfrI8DmWDDujK7JWm1E-TUOx-orcY3hou6Ef5ZJhpQ0hP2F_6BtCjqm-0t06QIaKenloprEzQz30P022lzUhD8_sSbC_HFzIx4YykorM2ruIx3FP0ZnDUZpvyDDvZGs5rH3vChlm1CoyHITvinD-VgxE4IrxETIQG_wTn_8_fNd1baiWvTZr_xJPhExskOF1eveQbouHdJ8kjghXv0mbUcr3t47wp-b7G0cEq4sdRvSR213ADi6w_3KvjGynW0v_dDDvXDIkVdP8T1g9mIp2RlfTa-ZyO_kmQZHt5244F3E7t0bAp2Z_0Rwsm4NFs_eLuTw_-x4AAP__yIIPYw==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a), sum(b), sum(c) FROM data GROUP BY d HAVING sum(a+b) > 10]
----
eJzUll1r4kAUhu_3VwznSulIcjKJbXMVt7Vdwcau2mVLV0o0gxVs4k4S2FL870uSUj-6O5MyCnqVzydz5jwvh7xC8nsOLgza3fbFkGRiTq76vRvy0P552211fFK77AyGg-_dOnl7Jcmea0GdFsfx23FSL6kwSANy3e_d3ZKv9yQk31o_Ov51iZATMq6TX5lpMk7QHAGFKA65HzzzBNwHQKBgAQUGFGyg4MCIwkLEE54kschfeS2ATvgHXJPCLFpkaX57RGESCw7uK6SzdM7BhWEwnvM-D0IuDBMohDwNZvNimbxEbyFmz4F4AQqDRRAlLmkYSIIoJEji9IkLoNDnUciFSzw88SxKPKSkODJKPBtGSwpxlq4qSNJgysHFJa1eZWs6FXwapLEwnM0ivfy65d8_-r3ho3_X7dY8p55Xe3dT86z3M_Z-Zr-fYX2ruNV64xfyFCRPW0shjJarDVj_3cDqO1kUi5ALHm58qfiKZItoflh4e49YcY9FL65m87QQ5KxC5bruZfuic9PqAoVelrq5M49RiTG22w37cSNeGOhsvfnvte2NtbF6prFKpg1sGNYeUq2oc0158zBTjbtMNR5Bqq3qybIqJctqGGwPyVLUudb208NMlrXLZFlHkCxWPVmsUrJYw7D3kCxFnWttPzvMZLFdJosdQbLs6smyKyXLbhjOHpKlqHOt7eeHmSx7l8myjyBZir_yPk8WcZTwSn9wZt4QHk552b0kzsSE34p4UixTXvYKrrgR8iQtn2J50YnKR3mB6zBuw7gOWxswfg5u6sDnOjBq1Y2OnLak_WZymMllNeW2bCntyGFHR7UcVqiWwwrVclilWkErVDd1VJ9K4TO5rDMdWXJYIUsOK2TJYZUsBa2Qda4jCxVTVDVG9eao3iDVm6Sao1RvlqLWMEXFNLUV0j6M009Jk9MqaXJaJU1OK6UpcJW0D0NVKm20_PI3AAD__zpJ4gQ=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT avg(a+b), c FROM data GROUP BY c, d HAVING c = d]
----
eJzMll9r2zAUxd_3KcR9SqiCI8lJW0PBWdd2gdTp8meslFBUW6SB1MpkZ6yUfPdhpyxOskkuSsBvtqyf7rk6h4vfIPk5Bw-GV72ryxFaqjm6HvRv0cPVj7tepxug2pfucDT81quj9y3817TG0Ql6qmMUrjdHPOXoZtAf36HP9yjEKEJfO9-7wQ0K0QWKJoAhlpEI-ItIwHsAAhgoYGCAwQUMLZhgWCgZiiSRKtvylgPd6Dd4TQyzeLFMs-UJhlAqAd4bpLN0LsCDEX-ai4HgkVBOEzBEIuWzeV4mk-Uv1OyFq1fAMFzwOPFQwyGIxxEiSKbPQgGG69k8FcpDPkMXyM8EDUQc5SvkxKcY-Qxn65MVBrlMN1qSlE8FeGSFy-vtTKdKTHkqldPalutn19EJ7h-D_ugxGPd6NZ_VM93j25pPsqfL_jgYvT9vb6T1HXWbgk-v6Jknzzu1CExWmw7ofzvYnLOMpYqEEtHWSfkpmh5Jc6_wrnbyt0n6_vTYzdpk-2269aI51DEYww7bViAbcuGQ1s7Of9d2t2qT8iEmZULskIZDjxpjg-KCxe2KxpgcMsakMjGm5aNES0WJNhx21CgZFBeu-bSiUaKHjBKtTJRY-SixUlFiDcc9apQMigvXfFbRKLFDRolVJkpu-Si5paLkNpzWUaNkUFy45vOKRsk9ZJTcykTJ8AM9EMlCxoko9RfWzNoW0VSs7yiRSxWKOyXDvMz6tZ9z-UIkknT9laxfuvH6UyawCJNdmBRhugWTj8FtG_jcBiZWuklLT1PtfTM9zPRmtfVuuVq6pYdbNlbrYYPVethgtR42WW2gDVa3baw-1cJnerPObMzSwwaz9LDBLD1sMstAG8w6tzGLGKaoaYzazVG7QWo3SS1Hqd0sJVbDlBimqWswbW-cfsg0PW0yTU-bTNPTRtMMuMm0vaGqNW2y-vQnAAD__4ub1j4=

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a+b), sum(a+b) FILTER (WHERE a < d), sum(a+b) FILTER (WHERE a = c) FROM data GROUP BY d]
----
eJzMltFv2joUxt_vX2GdJ1CNgu2EtpEqpfdeuiFR6ALVVnWocolFkWjMnERaVfG_T0m2EmhnpzKovJngX853zvfpKM-Q_FiAD6Nuv_vfGGVqgS7C4SW67X676p_3Bqjxf280Hn3pN9HvK0n22ODoCN03ceWMLnr9cTdEja-fu2EXcfQ9a7fZFEX6W2do2iwLRjzl6FM4vL5C_96gaAIYYhmJAX8UCfi3QAADBQwMMLiAwYMJhqWSU5EkUuVXngugF_0Ev41hHi-zNH88wTCVSoD_DOk8XQjwYczvFyIUPBLKaQOGSKR8vijK5DKCpZo_cvUEGEZLHic-ajkE8ThCBMn0QSjAEIo4EspHATkKKEYBKfsN3Px8FjCMAhcmKwwyS9dCkpTPBPhkheuLPZ_NlJjxVCrH29Qa5HM4H9zcDYbju8F1v98I3GYu-vqyEZDK6c_YA_rGM7Ylc135_gk98ORhqyiByWrdCv1rK-v3ZLFUkVAi2nhT8RZNs6T9qvB2t-se6cuJvZyKWQyz1EcBxQHDGkPYbrsYyJZcOsTbuvl2bXejNqmfXFInuQ5pOXR_2TXIrdjZOfTskl1ml3xUdmn9_NBa-aEth-0vPwa5lZEeH3p-6C7zQz8qP6x-flit_LCW4-4vPwa5lZGeHHp-2C7zwz4qP279_Li18uO2HG9_-THIrYz09NDz4-4yP-4hfHu9oTEUyVLGiaj1ZdXOuxTRTJQjSWSmpuJKyWlRpvw5LLjiQSSStPyXlD96cflXLrAKk22YVGG6AZP3wR0b-NQGJla6iaenqXbeTA8zvVkdvVuulvb0sGdjtR42WK2HDVbrYZPVBtpgdcfG6mMtfKI368TGLD1sMEsPG8zSwyazDLTBrFMbs4hhi5rWqN0etVukdpvUcpXa7VJitUyJYZu6BtNerdN3maanTabpaZNpetpomgE3mfZqqWpNm6z--RUAAP__UpvLjA==

# Same query but restricted to a single range; no local aggregation stage.
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(a+b), sum(a+b) FILTER (WHERE a < d), sum(a+b) FILTER (WHERE a = c) FROM data WHERE a = 1 GROUP BY d]
----
eJyUktGLm0AQxt_7VwzzlHB7xNU8CQd7bb1W8DQ1hva4yrHnDhIwrt1doSXkfy9qyyWlte3b7LffN_PT2SPaLw2GuI2S6E0BvWngLs_u4TH6tElu4xQWb-Ntsf2QLOGHxfaHhYQreF6ysxru4qSIclh8fB_lEUj43HteUIGad91AtZwGKukkvMgc3uXZbgOvH0CVyLDVilJ5IIvhI3Jk6GPJsDO6Imu1GeTjaIrVVww9hvu2690glwwrbQjDI7q9awhDTPW17lY-MlTk5L4ZbSeGuncvIetkTRgGJ3bWmM83LuRzQzlJRWblXbTH4ftEZ_YHab4hw20nWxvCil-PHDm1ikwIgl8Jn4Hg0-8T66G-EQEDscY_IfL_Qbyta0O1dNqs-CWhWCPD2_ThKc2Kp3SXJAuxXg6ou_uF4GfVzy0K_zdagAyz3oUgfCYCNoPtX2D_ZWU52U63lv5pZ96pZEiqpulZWN2bijZGV-OY6ZiNuVFQZN10G0yHuJ2uBsDzMJ8N-_Nhfzbs_RIuT6--BwAA__8QIBmb

# Verify the XOR execution plan
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT xor_agg(to_hex(a)::bytes) FROM data]
----
eJyslF1v2jAUhu_3K6xzVSSj4CRQ6quyjVVIrHTARacqQh4-SpFonNmOxIT471OSTg2odTIll_l487x5jnWOYH7vgcNqOp9-WZNM78m35eI7eZo-Pswns3ty9XW2Wq9-zHvk9ZWD0hsRx1dWbZ7xcCV6nH_-uZ6uemVQCisioJAoiffiBQ3wJ2BAwQcKAVAIgcIQIgqpVls0Run8lWMRmMkD8AGFXZJmNr8dUdgqjcCPYHd2j8BhLX7tcYlCovYGQEGiFbt9gcnZt6nevQj9ByisUpEYTvoeIyKRhBFln1EDhSUmEjUnr79wy_79A0QnCiqzb3RjRYzA2Yk2bziJY42xsEp7w_OCj4vlZnJ3lxM_RPkfot4IWaK0RI3y7PPRyV2GDf6_TXDWhjUfDWsyGo_1Pb_j4dR0rPgYtR2O31yH30iH3_eCjnXUdKzouG6rI2iuI2ikI-h7Ycc6ajpWdIzb6gib6wgb6Qj73rBjHTUdKzpuutxk76CWaFKVGLzYaO9_eZBvOpQxlmvRqExv8UGrbYEpLxdFrrgh0djyKSsvZkn5KC9YDTNn2D8Ls8uw7ybXoANnOnSHwza9h87wyE0etSFfO8NjN3nchnzjntWg5pi4D9klOzp9-hsAAP__3OgMJA==

# Verify the XOR execution plan
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT xor_agg(a) FROM data]
----
eJyslNFq2zAUhu_3FOJcJSBjy3bS1FcJW1YCWdMluSgUU7To4AVcy5Nk6Ah592F7UCe0sod2aVu_v__jiHMC_SuHBHbL9fLznlQqJ1-3m2_kafn4sF6s7snoy2q3331fj8nfI69SPfMsG_Fxe1Jww1OgUEiB9_wFNSRPwIBCCBQioBADhQmkFEolD6i1VPWRUxNYiVdIAgrHoqxM_TqlcJAKITmBOZocIYE9_5HjFrlA5QdAQaDhx7zB1Ox5qY4vXP0GCruSFzohns8ILwRhRJqfqIDCpjIJmTNIzxRkZd5Y2vAMIWFnOrzPIssUZtxI5U8u6zxuts-Lu7vRnI0_RIUfot4IVSGVQIXi4vfp2V6GBf_eJrpow4YPgg0ZhM88P3QaRU-jjv3UdRThcPlwkHzo-ZGTfE-jjvyNq3w0XD4aJB95fuwk39OoIz9zlY-Hy8eD5GPPnzjJ9zTqyN_-zw30DmqLupSFxqtN9P6fg3pDociwXWdaVuqAD0oeGkz7uGlyzQuB2rRfWfuwKtpPdcFumFnD4UWYXYdDO7kHHVnTsT0cu_SeWMNTO3nqQr6xhmd28syFfGufVdBzTeyX7Jqdnj_9CQAA__-PNOlb

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT max(t.a), min(t.b), avg(t.c)  FROM (VALUES (1, 2, 3), (4, 5, 6), (7, 8, 0)) AS t(a, b, c) WHERE b > 3]
----
eJyUkF1r2zAUhu_3Kw7nSoJDajv7KLqK2dzNkKRdnHWFzheKfTAGxcokuRSC__uwPbZ10LHena_nfYTO6L8bVFhk6-z9Hnpn4Gp3vYH77O5mneZbEB_yYl98Xkv4eXLUjyIstCQ4tp0Ii4Mk0A-NCItKzqy4TddfsgJETJAQLCWBeE3whuDtWL4juCSIpIS0gABCExwIKglfP2W7DA7wrY-iJcOyRMLO1rzVR_ao7jHGkvDkbMXeWzeOztNBXj-iigjb7tSHcVwSVtYxqjOGNhhGhcZW2sCDNj17iC4iJKw56NZMyVetCewUrJJfdqVUvt1fYjkQ2j78TvZBN4wqHuj_7WnTOG50sO4ifmrepHdiFUsk3ORbsUrGKr39KFZL-aw6eYl6x_5kO89PtM8lR0NJyHXD8-d627uKb5ytJs3cXk_cNKjZh3kbz03ezavxgX_C8T_h5C-4HF79CAAA__8-tMoV

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT * FROM (VALUES (1, '222'), (2, '444')) t1(a,b) JOIN (VALUES (1, 100.0), (3, 32.0)) t2(a,b) ON t1.a = t2.a]
----
eJyckU9r20AQxe_9FMNcLJXB3l35JAjItC51cK00Sksh-LCVpo5gq3V3V6Vg_N2LVin5Q9PGuWlm3m-e5u0B_Q-DOVbL9fLNFfTOwLvL8gNcL79crBerDSRvV9VV9XGdwq3k9ShIPi_Wn5YVJJJgopSapASJIpjM5_NJmsKigiAh0QRfUzgvh033CCnEVAxERpCpqbgF1B-g3ECQUw1nENRUb5Gwsw1v9Hf2mF-jxC3h3tmavbduaB2iYNX8wlwQtt2-D0N7S1hbx5gfMLTBMOZobK0N_NSmZw9iJpCw4aBbE_VHQtuHO9oHvWPM5ZFe6CBn8lkO6kmHu8V9Z13DjpvHG_8v-ctvvtf-5ty2HbuZeqBGw99CUsj0zLW7m_iFhGUfcigkFYqKjIo5PnVJdkpWl-z3tvP8rIzEcAY3Ox5j8bZ3NV84W0ebsSwjFxsN-zBO1VisujiKj3kflifA6jGs_glnD2Bx3B5f_Q4AAP__go0S1Q==

statement ok
CREATE TABLE nullables (a INT, b INT, c INT, PRIMARY KEY (a))

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT array_agg(a) FROM (SELECT a FROM data WHERE b = 1 AND c = 1.0 AND d = 1.0 ORDER BY a)]
----
eJzMlNFr2zAQxt_3V4h7spkyR7YzimBgr3E6Q5p0TmArxRQ1OryAa2WSAish__uwna7zWDaXvOTNn-4-3_e7h9uB-V4Ch0UyTS6XZKtLMsnm1-Qu-XozjdMZccbpYrn4PHXJoUVoLZ7uRVE4wm17nedKK6Wwgnz5lGQJcZwH8oEwl8SzMXFW9fe7oXuQ8iDJPBsnGfl4S4SbA4VKSZyJRzTA74ABBR8oBEAhBAojyClstFqhMUrXLbvGkMofwIcU1tVma-vnnMJKaQS-A7u2JQKHpXgoMUMhUXtDoCDRinXZjKkzRxu9fhT6CSgsNqIynAw8RkQlCSPKfkMNFCbr0qLmxHEiv47POU9ny4sDURS0SJzzyXQeLy-eUaPwV2GcXKbX8dQFCvOt5SRikO8pqK19CW6sKBA429MjcC9MSkvUKLs0EXsL-f4vG4iLQmMhrNLeqGuJsyy-vY-vrpyIuUcT-Z1ErP-6WZ91e2zg-eezcL8_nt8Lzx94wfngBf3xgl54wcALzwcv7I8X9sILB97ofPD-c-oyNBtVGeyQHfvzsD4VKAtsT4tRW73CG61WzZhWzhtf8yDR2LbKWpFWTakJ-LuZ_dP8vmMe_mn2T5kcnGIOTzGPXmXO929-BgAA__9NfD8a

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT json_agg(a) FROM (SELECT a FROM data WHERE b = 1 AND c = 1.0 AND d = 1.0 ORDER BY a)]
----
eJzMlNGL00AQxt_9K5Z5SnBrukkqx4KQeM2dkV5zpgWVIxx73SFWctm6uwWl9H-XJNUzYjXSl77l25kv8_3mYXZgvlTAYZHMkssl2eqKXOXZDblLPtzO4nROnGm6WC7ezVxyaPlsVH0vytIRbtfqHAqik1JYQd6_SfKEOM4DeUWYS-L5lDir5vvF2D1IeZAky6dJTl5_JMItgEKtJM7FIxrgd8CAgg8UAqAQAoUJFBQ2Wq3QGKWbll1rSOVX4GMK63qztc1zQWGlNALfgV3bCoHDUjxUmKOQqL0xUJBoxbpqxzSZo41ePwr9DSgsNqI2nIw8RkQtCSPKfkINFK7WlUXNieNEfhOfc57OlxcHoijokDjnV7MsXl78QI3Cn4VpcpnexDMXKGRby0nEoNhTUFv7FNxYUSJwtqdH4J6YlJaoUfZpIvYciv0fNhCXpcZSWKW9Sd_ydpHN7-Praydi7tFAfi8QG75tNmTbHht5_vns2x-O5w_C80decD54wXC8YBBeMPLC88ELh-OFg_DCkTc5H7x_XLoczUbVBntkx_48bi4FyhK7y2LUVq_wVqtVO6aTWetrHyQa21VZJ9K6LbUBfzWzv5pf9szj383-KZODU8zhKebJf5mL_bPvAQAA__9O9z5w

# Test that orderings on GROUP BY columns are propagated through aggregations.
statement ok
CREATE TABLE sorted_data (a INT PRIMARY KEY, b INT, c FLOAT, INDEX foo(b))

# Split into ten parts.
statement ok
ALTER TABLE sorted_data SPLIT AT SELECT i FROM generate_series(1, 9) AS g(i)

# Relocate the ten parts to the five nodes.
statement ok
ALTER TABLE sorted_data EXPERIMENTAL_RELOCATE
  SELECT ARRAY[i%5+1], i FROM generate_series(0, 9) AS g(i)

# Verify data placement.
query TTTI colnames,rowsort
SELECT start_key, end_key, replicas, lease_holder FROM [SHOW RANGES FROM TABLE sorted_data]
----
start_key  end_key  replicas  lease_holder
NULL       /1       {1}       1
/1         /2       {2}       2
/2         /3       {3}       3
/3         /4       {4}       4
/4         /5       {5}       5
/5         /6       {1}       1
/6         /7       {2}       2
/7         /8       {3}       3
/8         /9       {4}       4
/9         NULL     {5}       5

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT a, max(b) FROM sorted_data GROUP BY a]
----
eJyUkVGrm0AQhd_7K5Z5UtgQNfRln7RtWgSjqRpICBI27lQCxrW7KwSC_72ohSaFeO99nJnzzTk7ewf9uwYG2Tpaf81Jp2ryPU025Ljeb6MgjIn1Lczy7Gdkk78STsmV36yzPQm1VAbFSXDDyY802W3JlwPhBVBopMCYX1EDO4ILFD5DQaFVskStpRra91EUihswh8KlaTsztAsKpVQI7A7mYmoEBrFcyHbpAQWBhl_qUdZTkJ35B2nDKwS26unDYnd-cc7PNabIBaql87QeHp7m_5ISKGQtbzQjC6CQdIYR36W-B69yuB_JEVSVwoobqZbucwx_qIP4cIqT_BTvosjyXRsobIK95Xv2S3vvyf6N-6aoW9lofNeBnb6ggKLC6Q-17FSJWyXL0WYqk5EbGwK1maarqQibaTQEfITdWdibh71Z2PkPLvpPfwIAAP__vNH0cA==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT a, max(b) FROM sorted_data GROUP BY a ORDER BY a]
----
eJzMlmFr4jAYx9_fpwjPK-UiNWl1W1_p3bxDcHanDjaGjMwGJzjTSyJsDL_70fbAut2SltTDd9rml-ef_B4e-gbq9xpCmA5Gg-8ztJVr9GMSXaH7we31qD8co8blcDqb_ho10d8lDKNn9tJ4bOYLlZCaxw8x0wz9nEQ31-jbHWIomlwOJtnPOWDYiJiP2TNXEN4DAQwUMPiAIQAMHZhjSKRYcKWETJe8ZcAwfoGwjWG1SbY6fTzHsBCSQ_gGeqXXHEKYscc1n3AWc-m1AUPMNVutszKFYL1Erp6ZfAUM04RtVIhaHkFsEyOChH7iEjBEWx2iHsE9CvMdBrHV-6pKsyWHkOxw-WT95VLyJdNCep3DYL30AiIZc8njtCRg6I_vHsbR7GF8Mxo1eqQJGK76t40ebb4Ls9__8RU9MfX0Yev5bh-Yfhp4v4_Ig7zf52u-keFUpF3fsfaR_dojj0VLJB45lPBZ-eCgPCnffKRC83mk5VHX9rNkK4jqnkb7kZrbjxy__Wh5_7SKf9ryfFf_lmyFmzo7Df-0Zv_0-P798v79Kv79lhe4-rdkK9zU-Wn492v27x_ff1Def1DFf9DyOq7-LdkKN3VxGv6Dmv0H__fz4x9pJlwlYqN4qS-LdnoeHi95fn4ltnLBr6VYZGXyv1HGZQ9irnT-luR_hpv8VRqwCJP3MCnC9AAm1eCuC3zhAhOn3KRjpqnxvn0z7Jtldc22AiPdMcMdF9Vm2KLaDFtUm2GbagttUd11UX1mhM_Nss5dZJlhiywzbJFlhm2yLLRF1oWLLGKZorYx6jZH3Qap2yR1HKVus5Q4DVNimaaBRdqHcVpJmpm2STPTNmlm2irNgtukfRiqRmnz3Zc_AQAA__9D8H8M

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT c, min(b), a FROM sorted_data GROUP BY a, c]
----
eJzMlt9v2jAQx9_3V1j3BJpRcH7QNk90Wzch0dABlVZVqHKJRZFozGwjrar43yeSSaTAfAHzkMcQf3J3_n504h307wXEMLrp33wdk5VakO_DwS15vPl117_uJaTxrTcaj372m-TfkSklr_Os8dykhBdntVRGpE8pN5z8GA7u78iXB8IpmU6AQiZTkfBXoSF-BAYUfKAQAIUQKEQwobBUciq0lmpz5D0HeukfiNsU5tlyZTY_TyhMpRIQv4OZm4WAGMb8eSGGgqdCeW2gkArD54u8TKmh7lLNX7l6AwqjJc90TFoeIzxLCSPSvAgFkzUFuTLbQtrwmYCYrWn1Zq5nMyVm3EjlRR976W5mHqhUKJHGJH-6Th6eksH4Kbnv9xtd1gQKt72k0fWbey-D5k5_25LPb-SF65e9apP1dgb_vzNsvyOL3na_87n4kGVQ1j7zpBQGKxOTbkC7Ps0nOZxMUGGqVXZoroMjJbIllx6Ldk4erh1-qM2qK8qOUNRjLc8_QVKknVJ2ndpKys4sKauFpH51UfxjRPFbXnCCKEg7pfu7qK0o_plF8WshSlBdlOAYUYKWF54gCtJO6f4uaytKcGZRglqIElYXJTxGlLDlRSeIgrRTur-r2ooSnlmUsBaiIP9ch0IvZaZFpX8_7c3IIp2J4oq0XKmpuFNympcpHgc5l_-QCm2Kt6x46GXFq02DZZjtwqwM-x9gdhzccYGvXGDm1DeL7LRvve_ADgf2sDr2tEIrHdnhyCVqO4xEbYeRqO0wFjVCI1F3XKK-sMKX9rAuXcKyw0hYdhgJyw5jYSE0EtaVS1gM2aLYGnXbo26L1G2TOq5St13KnJYpQ7ZpiIS2t06PCs1OY6HZaSw0O42GhuBYaHtL1RraZP3pbwAAAP__Cjuy1g==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT c, min(b), a FROM sorted_data GROUP BY a, c ORDER BY a]
----
eJzMllFr4kwUhu-_XzGcK-UbiZOJts2V3a27CDbpqoUtRcrUDFawGXcywpbif19MFox1O8c4XuRyTJ6cc-Z5OfgO2a8lhDDuD_tfJ2Stl-TbKL4lj_2fd8PrQUQaN4PxZPxj2CR_X5lR8rpIG89NSkTxbqa0kclTIowg30fx_R358kAEJTMSj276o_w0BQqpSmQkXmUG4SMwoOADBQ4UAqDQgSmFlVYzmWVKb195z4FB8hvCNoVFulqb7c9TCjOlJYTvYBZmKSGEiXheypEUidReGygk0ojFMi9T6q230otXod-Awngl0iwkLY8RkSaEEWVepIbphoJam12hzIi5hJBt6PHNXM_nWs6FUdrr7PfS284c60RqmYQkP11HD09RPHmK7ofDRo81gcLtIGr0_ObBQ9780N-u5PMbeRHZy0G16WY3g__pDLvvqKK3j9_5v_iQZVDWPvOkFOK1CUmP055P80n-bYafPBX_ZKpItdTKY_vqPisf7JVnx6eUVUipx1qef0JOkXZK-rq1zSk7c05ZLXLqHx8Uv0pQ_JbHTwgK0k7p_i5qGxT_zEHxaxEUfnxQeJWg8JYXnBAUpJ3S_V3WNij8zEHhtQhKcHxQgipBCVpe54SgIO2U7u-qtkEJzhyUoBZBQf68jmS2Umkmj_r3096OLJO5LK4oU2s9k3dazfIyxTHOufyHRGameMqKwyAtHm0bLMPsI8zKsL8Hs2pw1wW-coGZU9-sY6d9631zO8ztsrp2W4GV7tjhjotqO4yotsOIajuMqUZoRHXXRfWFFb60y7p0kWWHEVl2GJFlhzFZCI3IunKRxZAtiq1Rtz3qtkjdNqnjKnXbpcxpmTJkmwaItIN1Wkmancak2WlMmp1GpSE4Ju1gqVqlTTf__QkAAP__XeS1rQ==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT b, max(c) FROM sorted_data@foo GROUP BY b]
----
eJyUktFq2zAUhu_3FOK_SkAlsd3d6MrZlo0M186SFFqKCYp1ZgyO5UkydIS8-7BdtqZgr7nU0fnO_4mjE-yvEgLbZbT8vGONKdnXTXLHnpYP62ixitnky2q72_6Ipuyl5cDZUT5PsmnfaLVxpPZKOhn-1Jp92yT3a_bpkR1ScFRaUSyPZCGe4IHjI1KO2uiMrNWmLZ-6ppV6hphzFFXduLaccmTaEMQJrnAlQSDWN7qeBeBQ5GRRdm1nDt24f5B1MieI2zN_NdgbH7yTh5I2JBWZ2fxiPN48DxzbWlZWsBtwJI0TLPQwJOFdI_FdF9WLgzfsUJviKM3vv-E-D4PBfP-a_EWeG8ql02bmX-aHrU9iFBlS3Xs5FvHjPk52-_g-iiahNwXH3eJhEvrTQZngQuY_q96QrXVl6V27np9TDlI59d_J6sZktDY662L6Y9JxXUGRdf3tbX9YVf1VK_ga9kZhfxz2R-FgHA5G4fkbOD1_-BMAAP__ogc4Fg==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT * FROM (SELECT a, max(c) FROM sorted_data GROUP BY a) JOIN (SELECT b, min(c) FROM sorted_data@foo GROUP BY b) ON a = b]
----
eJzMl1Fv4jgQx9_vU1jzBLdGwU6gFGml9O56J1YUem1X2tUKVYa4FInGnBOkXVX97qeQnggEPHFNb_O2BP_sGfL779TPkPyzhD7cXg4vf78ja70kf96Mr8i3yy_Xw4vBiDT-GNze3f49bJLXJb_mCxqvHwUlT-J7Y9bMHydKpzK6j0QqyF8348_X5LevRDTJp3G21yszpeRpER9iwgeltty0ScYjIshHMp0AhVhFciSeZAL9b8CAAgcKPlAIgEIHJhRWWs1kkiidLXneAIPoO_TbFBbxap1mjycUZkpL6D9DukiXEvpwJ6ZLeSNFJLXXBgqRTMViuTmmWNtKL56E_gEUblciTvqk5TEi4ogwotJHqYHCeJ32Scho6MPkhYJap9tTk1TMJfTZC61e2cV8ruVcpEp7nd3CwuwHGOtIahllRwKFi9HX-9H47n70eThshKwJFK4uvjRC3twrZrv_9Ad5FMljaevJy7ZgfrTg7T4qL2R_nw_5RoauWPtnteW7tUW3q9bxoXUHO7-Sei4_qUUstcd6u_su5UPaCNmH5ke9mD_m_ywqxWno0zA4KtZZhYYsSh2pllp53N9befjs3s7ZrHrcmEXcPNbyuGvgkNoKanbrETh24sCxegTOuq0TBO78PQPHq0vPbaTnLc93lR6praDHWT2k5yeWntdDeuu23KXn7feU3q8uvW8jvd_yAlfpkdoKevTqIb1_Yun9ekhv3dYJpGfvKX1QXfrARvqg5XVcpUdqK-hxXg_pgxNLH9RDegtHWOe4JA9KFa6bWyGO2hDYVJGl5b8iulVMzU_nJh07b9SRve0vj8HI-cV13Xw8wf9W_P-6CB4o5EYmKxUnstI1r521IqO5zH-dRK31TF5rNdsck38cb7jNg0gmaf4tyz8M4vyrrMAizPZhVoT5Dszs4DMXmDEnuuNEn5tpbqR9F7jnAjPkdSF014XmSNu-UdLADAdGmAdmxTtGumuGuy75MMNIPswwlg-ERvKB0Eg-zlzyYYaRfJhhLB8IjeTDTGP56Lnk49w8AdrICCgNEKsZYKaxIWCm0SmA4NgYQHDEc2YeI8gbR2jEdITGVMdwxHUEx2RnpVliYzszzxKGjANWmiZWuptpTHczjeqO4JjuCI7pXhqkVrqbaUx3M43qjuCY7mYc1b00Tq10Lw2WXd17iO6lyWKlu5nGdDfTqO4IjumO4JjupalqpbuZxnQ306juCI7pbsYx3bn5QsqRGykvzZZdnCO4ze2MW9I9J3rvtVnjXSecY63bXdEmL7_8GwAA__-kmUNE

# Verify that the stages preserve the ordering as expected.
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(x) FROM (SELECT a, b::float + c AS x FROM data) GROUP BY a ORDER BY a]
----
eJzMllFv2j4Uxd__n8K6T6AaBTuB0jyF_0onJEq6QKVVFapcYlEkGjM7SK2qfvcpSTcCrHY6Rx1vJPjne-49R1d5AfVjBT5MBqPBlynayBW6iMJLdDv4fjXqD8eocT6cTCffRk30dkRtHhtPzeJU4-0dw-je9y9GYX_aQydojvoT9FQciVnKmuhrFF5fof9vEENhdD6I8p8zwJCImI_ZI1fg3wIBDBQwuIDBAwwdmGFYSzHnSgmZHXnJgWH8BH4bwzJZb9Ls9QzDXEgO_guky3TFwYcpu1_xiLOYS6cNGGKesuUqL5NJCtZy-cjkM2CYrFmifNRyCGJJjCgS6QOXCjBEPIm59FHgngT0V38YBQRmrxjEJt2WVylbcPDJK64usb9YSL5gqZBOZ1dhkE0hlDGXPPZR_tQf39yNw-nd-Ho0agS0mQm_vmwEpLknZnv__TN6YOph7-pM_FYwfVfw9h5RCNm_56S4SNMVaR_ULrdFDtoiv9vKGww3adY91gzc_Wv99B39Y9ESa4fsOvJeeW-nPKkeSVIlkg5pOTQPJSlCWUMmDRpL7nWPI5Ok5kyST84krR4KWikUtOW4NYfCoLE0vtPjCAWtORT0k0PhVg-FWykUbsvxag6FQWNpfL3jCIVbcyjcTw6FVz0UXqVQeK38w8I2CAZdpZGdHUcQvJqD4P3Dz5g_SIu4WotE8UpfKO2sOR4veDEMJTZyzq-kmOdliscw5_IXMVdp8S8pHoZJ8VcmsAyTfZiUYboDk4_BXRv4zAYmVrpJR09T7bxdPezqzerq3fK0dEcPd2ys1sMGq_WwwWo9bLLaQBus7tpYfaqFe3qzejZm6WGDWXrYYJYeNplloA1mndmYRQxb1LRG7fao3SK126SWq9RulxKrZUoM29QzmHawTj9kmp42maanTabpaaNpBtxk2sFS1Zo2e_3vZwAAAP__dg2WgA==

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(x) FROM (SELECT a, b::float + c AS x FROM data) WHERE a > x GROUP BY a ORDER BY a]
----
eJzMll1v2kwQhe_fX7GaK1AWmV2bL1_B25AWieDUELVRiqINXhEkgunaSERR_ntlb1I-3OyYYqXcge3Hc2bPmZGfIfo5BxeG3X7304is1Jxc-N4lue1-v-p3egNSOu8NR8Ov_TJ5fSRaPZbWZf1U6fWaoOTedS_6XmfUJGdkQjpDstaPBCIWZfLtS9fvEkF-rKpVW5I1-ex711fk_xsiiOefd_305xgoLMJADsSjjMC9BQYUOFCwgYIDFGowprBU4URGUaiSR55ToBeswa1SmC2Wqzi5PKYwCZUE9xniWTyX4MJI3M-lL0UglVUFCoGMxWyelkk0tpdq9ijUE1AYLsUicknFYkQsAsJJGD9IFQEFXy4CqVzSts_a_K1hStoMxi8UwlW8KR_FYirBZS80v8RBWAmXVm1X3MVsHqc1-dvpGcrxQ8p1plMlpyIOlcX2TqSdnLqnAqlkkJQGCp3Bzd3AG90Nrvv9UpuXk4O6viy1WXlPzabA_RN5ENHD3qsT9RvF9ruKN-8JtZD995zpF5naqmVqb7fFMm2x322lDXqrOOmeGk7c-Wv9_B39OgV815H3ytd2yrP8I8DyjIDFKhZPh4DpIShgBhCNuvt6YTOAlNsOCzuNGWAFz0D9g2eA5w8hzxVCXrHsgkOIaNQhbBQWQqTctlv8NELICw5h44NDaOcPoZ0rhHbFcgoOIaJRh7BZWAiRcttu2acRQrvgEDY_OIRO_hA6uULoVNKvw2ODh-jSwWsVFjyk3LZDzmkEzyk4eK1_-Bn6B2m-jJbhIpK5vjCrSXMymEp9GFG4UhN5pcJJWkb_9VIuvRDIKNZ3mf7TW-hbicBtmBlhbob5Psy2YXsHZofBzWNgxo-i68fQvGqmbeOBO2bYMbuFeF0z0nUzXDfCDTPcOCYoZhgJihnGgoLQSFDMNBaU5jFBaZl3QhVZCshKwXZKZqkcYjdCI34jNGY4hiOOIzhmOcuslkM8Z-bVwhzENfNyYTUEz2yXg0w305jpZho1HcEx0804arp5s2KmZ5bMrmtNxDXzlmEtBM_smYNMN9OY6WYaNR3BMdPNOGY6N2_YfdPHL__9CgAA__-3DLSZ

# Ensure that an interesting input ordering that causes an ordered group by
# forces an ordered synchronizer. We create an index on b even though it's
# not used to help the optimizer realize that there's an ordering available
# on b for a constrained scan on the a,b primary index.

statement ok
CREATE TABLE data2 (a INT, b INT, PRIMARY KEY (a, b), INDEX(b));
ALTER TABLE data2 SPLIT AT SELECT 1,i FROM generate_series(1, 9) AS g(i);
ALTER TABLE data2 EXPERIMENTAL_RELOCATE
  SELECT ARRAY[i%5+1], i FROM generate_series(0, 9) AS g(i);

# Verify data placement.
query TTTI colnames,rowsort
SELECT start_key, end_key, replicas, lease_holder FROM [SHOW RANGES FROM TABLE data2]
----
start_key  end_key  replicas  lease_holder
NULL       /1/1     {2}       2
/1/1       /1/2     {5}       5
/1/2       /1/3     {5}       5
/1/3       /1/4     {5}       5
/1/4       /1/5     {5}       5
/1/5       /1/6     {5}       5
/1/6       /1/7     {5}       5
/1/7       /1/8     {5}       5
/1/8       /1/9     {5}       5
/1/9       NULL     {5}       5


query T
EXPLAIN (opt,verbose) SELECT b, count(*) FROM data2 WHERE a=1 GROUP BY b
----
group-by
 ├── columns: b:2 count:3
 ├── grouping columns: b:2
 ├── internal-ordering: +2 opt(1)
 ├── stats: [rows=9.5617925, distinct(2)=9.5617925, null(2)=0]
 ├── cost: 11.1256179
 ├── key: (2)
 ├── fd: (2)-->(3)
 ├── prune: (3)
 ├── scan data2
 │    ├── columns: a:1 b:2
 │    ├── constraint: /1/2: [/1 - /1]
 │    ├── stats: [rows=10, distinct(1)=1, null(1)=0, distinct(2)=9.5617925, null(2)=0]
 │    ├── cost: 10.81
 │    ├── key: (2)
 │    ├── fd: ()-->(1)
 │    ├── ordering: +2 opt(1) [actual: +2]
 │    ├── prune: (2)
 │    └── interesting orderings: (+1,+2) (+2,+1)
 └── aggregations
      └── count-rows [as=count_rows:3]

query TTTTT
EXPLAIN (verbose) SELECT b, count(*), corr(a, b) FROM data2 WHERE a=1 GROUP BY b
----
·          distributed  true           ·                 ·
·          vectorized   false          ·                 ·
group      ·            ·              (b, count, corr)  ·
 │         aggregate 0  b              ·                 ·
 │         aggregate 1  count_rows()   ·                 ·
 │         aggregate 2  corr(a, b)     ·                 ·
 │         group by     b              ·                 ·
 │         ordered      +b             ·                 ·
 └── scan  ·            ·              (a, b)            +b
·          table        data2@primary  ·                 ·
·          spans        /1-/2          ·                 ·

query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT b, count(*) FROM data2 WHERE a=1 GROUP BY b];
----
eJzMlF-Lm0wUxu_fTzGcq-TtLGYmfwpCwXRrW8HVVA3bZZEw0cENuI6dGaHLku9e1EBMmnWTtpRejuf8znme84DPoL7lYEJou_Z1hCqZo4-Bf4Pu7a8Ld-54aPDBCaPwiztEu5Y1RomoCj34f9i2pkwzim4_24GNGHqHCPoU-MsFen-H1jFgKETKPfbIFZj3QAADBQxTiDGUUiRcKSHr0nPT6KTfwRxh2BRlpdvPeqNzDiZUhZAplzwFDCnXbJPX9XgbY0iE5GDuWz1xJUpjdtSIQVR6NzbGoDTLOJiTLe6sJp3VJwZHbJ3zgLOUS2N0MB6aM1il3Dwy-QQYwpIVykQGuTKIUdv2K20ii8JLQsglQuZZJnnGtJAGPdRhNbvaS5moec29u5XnRytv6boDiwwBw7W_9KJV4N-Gg-GRov2S9RN6YOrhp_nNzXeq6Yuq93NO5QYWeQMnw-tYm_yKtXB5s3K8aGDRY2d71eMD1fT80MmZodex04tDf0VI5zLjfyh0-mdDn_6d0Ef9tw64KkWh-Fn_kFFtiacZb0-gRCUTvpAiada0T7_hmg8pV7qtvm0fTtGWaoFdmPTCtB-mxzDpwuMDmFwGz_rhca_sUT886YWn_Z6nv-O5H37F8-wiz_H2vx8BAAD__zm6YjY=

statement ok
CREATE TABLE uv (u INT PRIMARY KEY, v INT);
INSERT INTO uv SELECT x, x*10 FROM generate_series(2, 8) AS g(x);

# Regression test for #37211 (incorrect ordering between aggregator stages).
query T
SELECT url FROM [EXPLAIN (DISTSQL) SELECT sum(v) FROM data INNER LOOKUP JOIN uv ON (a=u) GROUP BY u ORDER BY u]
----
eJzMlltv2koUhd_PrxjtJ9AZZGZsbpaORE5DK1JiUy5SowhFDh4RWuKhvkSNovz3ynYUDJTZdkEubxj7m71m1tpb8wLBjxWYMO4Neh8mJPJX5OPIvia3va_DwUXfIpXL_ngy_jKokrdPguix8lRNv3Kd0CF9y-qNyMC2P0-H5MruWyR6IrZFKg75j0RV8mlkT4fk_xsSEXt02RslP2dAwZOusJxHEYB5CwwocKCgAwUDKDRgRmHty7kIAunHn7wkQN_9CWadwtJbR2H894zCXPoCzBcIl-FKgAkT534lRsJxha_VgYIrQme5SsrEirtrf_no-M9AYbx2vMAkNY0Rx3MJJzJ8EH4AFOwoNEmXweyVgozCTbEgdBYCTPZK8wu6kkvvTU9jW0_0lFEzkPJ7tCbf5NIj0kvKvwuhXU67-kE5vIici8XCFwsnlL7Gds6nG3tg-67whWuS5OnCurmz7MmdNR0MKl1ejY9tel3p6tUdNZsC98_kwQkedpaOD3OjWD-oeLOOTIXsrvNvupBqW4292tltsb1tsfdtJRtMD51TRQCMP9bPD-i3ZE2uNb7tyKHyja3yLH9DsDwNobGaxpOWYGlLFO4IRFGmI5pldAQiJxsddh4dwU7cEc2SO4LnjyTPFUle0_SjIokoykSyVUYkETlZ7_h5RJKfOJKtkiOp54-kniuSek0zjookoigTyXYZkUTkZL3TzyOS-okj2S45kkb-SBq5ImnUkitmsRgiKjIx7JQRQ0RO1i_jPGJonDiGnb94ff2NtJEI1tILRK6baT3enHAXIj2MQEb-XAx9OU_KpI92wiV_uCII07csfeh76atYYBZmSpirYb4Lsyysb8GsGNw-Bmb8KLp5DM3ralpXHrihhg21W4jXDSXdVMNNJdxSw61jgqKGkaCoYSwoCI0ERU1jQWkfE5SOeibUkaGAjBRspuwNlSJ2IzTiN0JjhmM44jiCY5azvdFSxHOmHi3MQFxTDxfWQPC96VLIdDWNma6mUdMRHDNdjaOmqycrZvrekNl2rY24pp4yrIPge3OmkOlqGjNdTaOmIzhmuhrHTOfqCbtr-uz1n18BAAD__6mkzns=
